#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Prettier Git Integration - Smart formatting for staged files
# Uses development-friendly settings during commit process

echo "ğŸ¨ Running Prettier on staged files..."

# Check if there are staged files to format
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E "\.(ts|tsx|js|jsx|json|css|scss|md|yaml|yml)$" | tr '\n' ' ')

if [ -z "$STAGED_FILES" ]; then
  echo "ğŸ“ No formattable staged files found"
  exit 0
fi

echo "ğŸ“ Files to format: $STAGED_FILES"

# Use our optimized dev mode formatting
if node scripts/prettier-dev-mode.js staged; then
  echo "âœ… Prettier formatting completed successfully"
else
  echo "âŒ Prettier formatting failed"
  echo "ğŸ’¡ You can bypass with: git commit --no-verify"
  exit 1
fi

# Check for any remaining ESLint issues on staged files
echo "ğŸ” Running ESLint on staged files..."
if npm run lint:staged-only 2>/dev/null || true; then
  echo "âœ… ESLint check passed"
else
  echo "âš ï¸  ESLint issues found - check output above"
  echo "ğŸ’¡ Fix issues or bypass with: git commit --no-verify"
fi
