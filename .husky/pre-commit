#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Performance monitoring
start_time=$(date +%s.%3N)

# Emergency bypass mechanism
if [ "$MEDIANEST_SKIP_HOOKS" = "1" ]; then
    echo "🚀 Emergency bypass activated"
    exit 0
fi

# Developer bypass with guidance
if [ "$MEDIANEST_SKIP_PRECOMMIT" = "1" ]; then
    echo "⚠️  Pre-commit checks skipped"
    echo "   Remember to run 'npm run lint:fix' before pushing"
    exit 0
fi

# Fast incremental checks
NODE_OPTIONS="--max-old-space-size=512 --optimize-for-size" npx lint-staged --concurrent --quiet

# Performance reporting
end_time=$(date +%s.%3N)
execution_time=$(echo "$end_time - $start_time" | bc -l 2>/dev/null || echo "0")
if [ -n "$execution_time" ] && [ "$execution_time" != "0" ]; then
    printf "✅ Pre-commit completed in %.3fs\n" "$execution_time"
fi