# Deployment Guide

Complete deployment documentation for MediaNest across all environments.

## Overview

MediaNest supports flexible deployment options from local development to production environments. This guide consolidates all deployment strategies, configurations, and best practices.

## Deployment Options

### Quick Deployment Options

- [Docker Compose](./docker-compose.md) - Single-server deployment with containers
- [Local Development](./local-development.md) - Development environment setup
- [Production Server](./production-server.md) - Traditional server deployment

### Advanced Deployment

- [Kubernetes](./kubernetes.md) - Container orchestration deployment
- [Cloud Deployment](./cloud-deployment.md) - AWS, GCP, Azure deployment
- [High Availability](./high-availability.md) - Multi-server HA setup

### Specialized Deployments

- [Homelab Setup](./homelab.md) - Home server optimized deployment
- [Raspberry Pi](./raspberry-pi.md) - ARM-based deployment

## Quick Start - Docker Compose

The fastest way to deploy MediaNest:

`bash\n# Clone repository\ngit clone https://github.com/yourusername/medianest.git\ncd medianest\n\n# Configure environment\ncp .env.example .env\n# Edit .env with your settings\n\n# Start services\ndocker-compose up -d\n\n# Check status\ndocker-compose ps\n\n# View logs\ndocker-compose logs -f\n`\n\nAccess MediaNest at http://localhost:3000\n\n## Environment Configurations\n\n### Development Environment\n\n`yaml\n# docker-compose.dev.yml\nversion: '3.8'\nservices:\n  frontend:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile.dev\n    volumes:\n      - ./frontend:/app\n      - /app/node_modules\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=development\n      - REACT_APP_API_URL=http://localhost:3001/api\n    depends_on:\n      - backend\n    \n  backend:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile.dev\n    volumes:\n      - ./backend:/app\n      - /app/node_modules\n    ports:\n      - \"3001:3001\"\n    environment:\n      - NODE_ENV=development\n      - DATABASE_URL=postgresql://postgres:password@postgres:5432/medianest_dev\n      - REDIS_URL=redis://redis:6379\n    depends_on:\n      - postgres\n      - redis\n    \n  postgres:\n    image: postgres:14-alpine\n    environment:\n      - POSTGRES_DB=medianest_dev\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=password\n    ports:\n      - \"5432:5432\"\n    volumes:\n      - postgres_dev_data:/var/lib/postgresql/data\n    \n  redis:\n    image: redis:6-alpine\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis_dev_data:/data\n\nvolumes:\n  postgres_dev_data:\n  redis_dev_data:\n`\n\n### Production Environment\n\n`yaml\n# docker-compose.production.yml\nversion: '3.8'\nservices:\n  nginx:\n    image: nginx:alpine\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/ssl:/etc/nginx/ssl:ro\n      - static_files:/usr/share/nginx/html/static\n    depends_on:\n      - frontend\n      - backend\n    restart: unless-stopped\n    \n  frontend:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile.prod\n    volumes:\n      - static_files:/app/build/static\n    environment:\n      - NODE_ENV=production\n      - REACT_APP_API_URL=https://your-domain.com/api\n    restart: unless-stopped\n    \n  backend:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile.prod\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=${DATABASE_URL}\n      - REDIS_URL=${REDIS_URL}\n      - JWT_SECRET=${JWT_SECRET}\n      - PLEX_CLIENT_ID=${PLEX_CLIENT_ID}\n    depends_on:\n      - postgres\n      - redis\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3001/api/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n    \n  postgres:\n    image: postgres:14-alpine\n    environment:\n      - POSTGRES_DB=${POSTGRES_DB}\n      - POSTGRES_USER=${POSTGRES_USER}\n      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}\n    volumes:\n      - postgres_prod_data:/var/lib/postgresql/data\n      - ./postgres/postgresql.conf:/etc/postgresql/postgresql.conf:ro\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER}\"]\n      interval: 30s\n      timeout: 5s\n      retries: 3\n    \n  redis:\n    image: redis:6-alpine\n    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}\n    volumes:\n      - redis_prod_data:/data\n      - ./redis/redis.conf:/etc/redis/redis.conf:ro\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 30s\n      timeout: 3s\n      retries: 3\n\n  # Monitoring services\n  prometheus:\n    image: prom/prometheus:latest\n    ports:\n      - \"9090:9090\"\n    volumes:\n      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro\n      - prometheus_data:/prometheus\n    restart: unless-stopped\n    \n  grafana:\n    image: grafana/grafana:latest\n    ports:\n      - \"3002:3000\"\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards:ro\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}\n    restart: unless-stopped\n\nvolumes:\n  postgres_prod_data:\n  redis_prod_data:\n  prometheus_data:\n  grafana_data:\n  static_files:\n`\n\n## Environment Variables\n\n### Required Variables\n\n`bash\n# .env.production\n# Database Configuration\nDATABASE_URL=postgresql://username:password@postgres:5432/medianest\nPOSTGRES_DB=medianest\nPOSTGRES_USER=medianest_user\nPOSTGRES_PASSWORD=secure_password_here\n\n# Redis Configuration\nREDIS_URL=redis://redis:6379\nREDIS_PASSWORD=secure_redis_password\n\n# JWT Configuration\nJWT_SECRET=your-super-secure-jwt-secret-key-here\nJWT_EXPIRES_IN=30d\n\n# Plex Integration\nPLEX_CLIENT_ID=your-plex-client-id\nPLEX_CLIENT_NAME=MediaNest\nPLEX_CLIENT_VERSION=1.0.0\n\n# Application Configuration\nNODE_ENV=production\nPORT=3001\nCORS_ORIGIN=https://your-domain.com\n\n# Security Configuration\nSESSION_SECRET=another-super-secure-session-secret\nCSRF_SECRET=csrf-secret-key\nENCRYPTION_KEY=32-character-encryption-key-here\n\n# Email Configuration (optional)\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USER=your-email@gmail.com\nSMTP_PASS=your-app-password\nFROM_EMAIL=noreply@your-domain.com\n\n# Monitoring\nGRAFANA_ADMIN_PASSWORD=grafana_admin_password\n\n# Logging\nLOG_LEVEL=info\nLOG_FORMAT=json\n`\n\n### Optional Variables\n\n`bash\n# Rate Limiting\nRATE_LIMIT_WINDOW_MS=900000  # 15 minutes\nRATE_LIMIT_MAX_REQUESTS=100\nRATE_LIMIT_AUTH_MAX=5\n\n# File Upload\nMAX_FILE_SIZE=10485760  # 10MB\nUPLOAD_PATH=/app/uploads\n\n# External Services\nTMDB_API_KEY=your-tmdb-api-key\nOVERSEERR_URL=http://overseerr:5055\nOVERSEERR_API_KEY=overseerr-api-key\n\n# Performance\nNODE_OPTIONS=--max-old-space-size=2048\nWORKER_PROCESSES=2\n\n# Development\nDEBUG=medianest:*\nENABLE_SWAGGER=true\n`\n\n## NGINX Configuration\n\n### Production NGINX Config\n\n`nginx\n# nginx/nginx.conf\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n    \n    # Security headers\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n    add_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\n    add_header Content-Security-Policy \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;\" always;\n    \n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_min_length 1024;\n    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json application/xml+rss application/atom+xml image/svg+xml;\n    \n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/m;\n    limit_req_zone $binary_remote_addr zone=auth:10m rate=5r/m;\n    \n    # Upstream servers\n    upstream frontend {\n        server frontend:3000;\n    }\n    \n    upstream backend {\n        server backend:3001;\n    }\n    \n    # HTTP redirect to HTTPS\n    server {\n        listen 80;\n        server_name your-domain.com www.your-domain.com;\n        return 301 https://$server_name$request_uri;\n    }\n    \n    # HTTPS server\n    server {\n        listen 443 ssl http2;\n        server_name your-domain.com www.your-domain.com;\n        \n        # SSL configuration\n        ssl_certificate /etc/nginx/ssl/fullchain.pem;\n        ssl_certificate_key /etc/nginx/ssl/privkey.pem;\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384;\n        ssl_prefer_server_ciphers on;\n        ssl_session_cache shared:SSL:10m;\n        ssl_session_timeout 10m;\n        \n        # HSTS\n        add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n        \n        # Client max body size (for file uploads)\n        client_max_body_size 50M;\n        \n        # API routes\n        location /api/ {\n            limit_req zone=api burst=20 nodelay;\n            proxy_pass http://backend;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection 'upgrade';\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_cache_bypass $http_upgrade;\n            \n            # Timeouts\n            proxy_connect_timeout 30s;\n            proxy_send_timeout 30s;\n            proxy_read_timeout 30s;\n        }\n        \n        # Auth routes (stricter rate limiting)\n        location /api/auth/ {\n            limit_req zone=auth burst=5 nodelay;\n            proxy_pass http://backend;\n            proxy_http_version 1.1;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n        \n        # Static files\n        location /static/ {\n            alias /usr/share/nginx/html/static/;\n            expires 1y;\n            add_header Cache-Control \"public, immutable\";\n        }\n        \n        # Frontend app\n        location / {\n            try_files $uri $uri/ @frontend;\n        }\n        \n        location @frontend {\n            proxy_pass http://frontend;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection 'upgrade';\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_cache_bypass $http_upgrade;\n        }\n        \n        # Health checks\n        location /health {\n            access_log off;\n            return 200 \"healthy\";\n            add_header Content-Type text/plain;\n        }\n    }\n}\n`\n\n## SSL/TLS Setup\n\n### Using Let's Encrypt\n\n`bash\n#!/bin/bash\n# scripts/setup-ssl.sh\n\n# Install certbot\nsudo apt-get update\nsudo apt-get install certbot python3-certbot-nginx\n\n# Obtain SSL certificate\nsudo certbot --nginx -d your-domain.com -d www.your-domain.com\n\n# Set up auto-renewal\nsudo systemctl enable certbot.timer\nsudo systemctl start certbot.timer\n\n# Test renewal\nsudo certbot renew --dry-run\n`\n\n### Manual SSL Certificate\n\n`bash\n# Create directory for SSL certificates\nmkdir -p nginx/ssl\n\n# Copy your certificates\ncp /path/to/your/fullchain.pem nginx/ssl/\ncp /path/to/your/privkey.pem nginx/ssl/\n\n# Set proper permissions\nchmod 644 nginx/ssl/fullchain.pem\nchmod 600 nginx/ssl/privkey.pem\n`\n\n## Database Setup\n\n### PostgreSQL Configuration\n\n`conf\n# postgres/postgresql.conf\nmax_connections = 100\nshared_buffers = 256MB\neffective_cache_size = 1GB\nmaintenance_work_mem = 64MB\ncheckpoint_completion_target = 0.9\nwal_buffers = 16MB\ndefault_statistics_target = 100\nrandom_page_cost = 4\neffective_io_concurrency = 2\nwork_mem = 4MB\nmin_wal_size = 1GB\nmax_wal_size = 4GB\n\n# Logging\nlogging_collector = on\nlog_directory = 'pg_log'\nlog_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'\nlog_statement = 'none'\nlog_min_duration_statement = 1000\n`\n\n### Database Migration\n\n`bash\n# Run migrations\ndocker-compose exec backend npm run db:migrate\n\n# Seed initial data\ndocker-compose exec backend npm run db:seed\n\n# Create backup\ndocker-compose exec postgres pg_dump -U $POSTGRES_USER $POSTGRES_DB > backup.sql\n\n# Restore backup\ndocker-compose exec -T postgres psql -U $POSTGRES_USER -d $POSTGRES_DB < backup.sql\n`\n\n## Monitoring Setup\n\n### Prometheus Configuration\n\n`yaml\n# monitoring/prometheus.yml\nglobal:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'medianest-backend'\n    static_configs:\n      - targets: ['backend:3001']\n    metrics_path: '/api/metrics'\n    \n  - job_name: 'postgres'\n    static_configs:\n      - targets: ['postgres:9187']\n      \n  - job_name: 'redis'\n    static_configs:\n      - targets: ['redis:9121']\n      \n  - job_name: 'nginx'\n    static_configs:\n      - targets: ['nginx:9113']\n`\n\n### Health Checks\n\n`bash\n#!/bin/bash\n# scripts/health-check.sh\n\n# Check all services\nservices=(\"frontend\" \"backend\" \"postgres\" \"redis\")\n\nfor service in \"${services[@]}\"; do\n    if docker-compose ps $service | grep -q \"Up\"; then\n        echo \"✅ $service is running\"\n    else\n        echo \"❌ $service is not running\"\n    fi\ndone\n\n# Check API health\nif curl -f http://localhost:3001/api/health > /dev/null 2>&1; then\n    echo \"✅ API health check passed\"\nelse\n    echo \"❌ API health check failed\"\nfi\n\n# Check database connection\nif docker-compose exec -T postgres pg_isready > /dev/null 2>&1; then\n    echo \"✅ Database is ready\"\nelse\n    echo \"❌ Database is not ready\"\nfi\n`\n\n## Backup Strategy\n\n### Automated Backups\n\n`bash\n#!/bin/bash\n# scripts/backup.sh\n\nBACKUP_DIR=\"/backups\"\nDATE=$(date +\"%Y%m%d_%H%M%S\")\n\n# Create backup directory\nmkdir -p $BACKUP_DIR\n\n# Database backup\ndocker-compose exec -T postgres pg_dump -U $POSTGRES_USER $POSTGRES_DB | gzip > \"$BACKUP_DIR/db_backup_$DATE.sql.gz\"\n\n# Redis backup\ndocker-compose exec redis redis-cli BGSAVE\nsleep 5\ndocker cp $(docker-compose ps -q redis):/data/dump.rdb \"$BACKUP_DIR/redis_backup_$DATE.rdb\"\n\n# Application files backup (if any)\ntar -czf \"$BACKUP_DIR/app_files_$DATE.tar.gz\" uploads/\n\n# Clean old backups (keep 7 days)\nfind $BACKUP_DIR -name \"*backup*\" -mtime +7 -delete\n\necho \"Backup completed: $DATE\"\n`\n\n### Restore Procedures\n\n`bash\n#!/bin/bash\n# scripts/restore.sh\n\nBACKUP_FILE=$1\n\nif [ -z \"$BACKUP_FILE\" ]; then\n    echo \"Usage: $0 <backup_file>\"\n    exit 1\nfi\n\n# Stop services\ndocker-compose down\n\n# Restore database\nzcat $BACKUP_FILE | docker-compose exec -T postgres psql -U $POSTGRES_USER -d $POSTGRES_DB\n\n# Start services\ndocker-compose up -d\n\necho \"Restore completed\"\n`\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Container startup failures**\n `bash\n   # Check container logs\n   docker-compose logs service_name\n   \n   # Check container status\n   docker-compose ps\n   \n   # Restart specific service\n   docker-compose restart service_name\n   `\n\n2. **Database connection issues**\n `bash\n   # Check database logs\n   docker-compose logs postgres\n   \n   # Test connection\n   docker-compose exec postgres psql -U $POSTGRES_USER -d $POSTGRES_DB -c \"\\l\"\n   `\n\n3. **Permission issues**\n `bash\n   # Fix file permissions\n   sudo chown -R $USER:$USER .\n   \n   # Fix Docker permissions\n   sudo usermod -aG docker $USER\n   newgrp docker\n   `\n\n4. **Memory issues**\n `bash\n   # Check memory usage\n   docker stats\n   \n   # Increase memory limits in docker-compose.yml\n   services:\n     backend:\n       deploy:\n         resources:\n           limits:\n             memory: 1G\n   `\n\n### Performance Tuning\n\n1. **Database optimization**\n `sql\n   -- Check slow queries\n   SELECT query, mean_time, calls \n   FROM pg_stat_statements \n   ORDER BY mean_time DESC \n   LIMIT 10;\n   \n   -- Analyze table statistics\n   ANALYZE;\n   \n   -- Vacuum database\n   VACUUM ANALYZE;\n   `\n\n2. **Redis optimization**\n `bash\n   # Check memory usage\n   docker-compose exec redis redis-cli INFO memory\n   \n   # Monitor slow queries\n   docker-compose exec redis redis-cli SLOWLOG GET 10\n   `\n\n3. **Application tuning**\n `bash\n   # Monitor application metrics\n   curl http://localhost:3001/api/metrics\n   \n   # Check memory usage\n   docker-compose exec backend node --expose-gc -e \"global.gc(); console.log(process.memoryUsage())\"\n   `\n\n## Security Hardening\n\n### Container Security\n\n`yaml\n# Security-hardened service example\nservices:\n  backend:\n    build: ./backend\n    user: \"1001:1001\"  # Non-root user\n    read_only: true     # Read-only filesystem\n    tmpfs:\n      - /tmp\n      - /var/tmp\n    cap_drop:\n      - ALL\n    cap_add:\n      - CHOWN\n      - SETGID\n      - SETUID\n    security_opt:\n      - no-new-privileges:true\n    sysctls:\n      - net.core.somaxconn=1024\n`\n\n### Network Security\n\n`yaml\n# Network isolation\nnetworks:\n  frontend:\n    driver: bridge\n  backend:\n    driver: bridge\n    internal: true  # No external access\n\nservices:\n  nginx:\n    networks:\n      - frontend\n      \n  backend:\n    networks:\n      - frontend\n      - backend\n      \n  postgres:\n    networks:\n      - backend  # Only accessible from backend\n`\n\n## Related Documentation\n\n- [Architecture Guide](../02-architecture/README.md) - System architecture overview\n- [Implementation Guides](../04-implementation-guides/README.md) - Feature implementation\n- [Security Guide](../07-security/README.md) - Security best practices\n- [Monitoring Guide](../08-monitoring/README.md) - Observability setup\n- [Troubleshooting Guide](../10-troubleshooting/README.md) - Common issues and solutions
