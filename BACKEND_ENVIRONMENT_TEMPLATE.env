# MediaNest Backend Production Environment Template
# Copy to .env and fill in your specific values

# ================================
# APPLICATION CONFIGURATION
# ================================

# Application Environment
NODE_ENV=production
PORT=4000
HOST=0.0.0.0

# Frontend/CORS Configuration
FRONTEND_URL=https://your-domain.com
CORS_ORIGIN=https://your-domain.com
NEXTAUTH_URL=https://your-domain.com

# Version and Build Information (auto-populated by CI/CD)
VERSION=latest
BUILD_DATE=
VCS_REF=

# ================================
# DOCKER SECRETS CONFIGURATION
# ================================
# In production, these should point to Docker secret files
# Development: Use direct environment variables
# Production: Use Docker secret file paths

# Database Configuration
DATABASE_URL_FILE=/run/secrets/database_url
# Alternative: DATABASE_URL=postgresql://medianest:password@postgres:5432/medianest

# Redis Configuration  
REDIS_URL_FILE=/run/secrets/redis_url
# Alternative: REDIS_URL=redis://:password@redis:6379

# Security Secrets
JWT_SECRET_FILE=/run/secrets/jwt_secret
ENCRYPTION_KEY_FILE=/run/secrets/encryption_key
NEXTAUTH_SECRET_FILE=/run/secrets/nextauth_secret

# OAuth Configuration
PLEX_CLIENT_ID_FILE=/run/secrets/plex_client_id
PLEX_CLIENT_SECRET_FILE=/run/secrets/plex_client_secret

# ================================
# OPERATIONAL CONFIGURATION  
# ================================

# Logging Configuration
LOG_LEVEL=info
# Options: error, warn, info, debug

# Database Migration Control
RUN_MIGRATIONS=false
# Set to 'true' only for initial deployment

# Metrics Protection
METRICS_TOKEN=your-secure-metrics-token-here

# ================================
# RATE LIMITING CONFIGURATION
# ================================

# API Rate Limits (requests per window)
RATE_LIMIT_API_REQUESTS=100
RATE_LIMIT_API_WINDOW=60

# Authentication Rate Limits  
RATE_LIMIT_AUTH_REQUESTS=5
RATE_LIMIT_AUTH_WINDOW=60

# YouTube Download Rate Limits
RATE_LIMIT_YOUTUBE_REQUESTS=5
RATE_LIMIT_YOUTUBE_WINDOW=3600

# ================================
# JWT CONFIGURATION
# ================================

# JWT Settings
JWT_ISSUER=medianest
JWT_AUDIENCE=medianest-users
JWT_EXPIRES_IN=7d

# ================================
# DOCKER SECRETS CONTROL
# ================================

# Enable Docker Secrets Integration
USE_DOCKER_SECRETS=true
DOCKER_SECRETS_PATH=/run/secrets

# ================================
# EXTERNAL SERVICE CONFIGURATION
# ================================

# Webhook Secret (if using Overseerr webhooks)
OVERSEERR_WEBHOOK_SECRET=your-webhook-secret-here

# External Service URLs (optional)
PLEX_SERVER_URL=http://your-plex-server:32400
OVERSEERR_URL=http://your-overseerr:5055
UPTIME_KUMA_URL=http://your-uptime-kuma:3001

# ================================
# BACKUP CONFIGURATION
# ================================

# Backup Settings
BACKUP_RETENTION_DAYS=30
BACKUP_ENCRYPTION=true
BACKUP_CLOUD_SYNC=false
BACKUP_CLOUD_PROVIDER=s3
BACKUP_CLOUD_BUCKET=
BACKUP_NOTIFICATION_URL=

# ================================
# STORAGE PATHS
# ================================

# Data Storage Paths (host paths for Docker volumes)
DATA_PATH=./data
LOG_PATH=./logs  
BACKUP_PATH=./backups

# ================================
# SSL/TLS CONFIGURATION
# ================================

# Domain Configuration for SSL
DOMAIN_NAME=your-domain.com
CERTBOT_EMAIL=admin@your-domain.com

# ================================
# MONITORING CONFIGURATION
# ================================

# Timezone for logs and monitoring
TZ=UTC

# Health Check Intervals (seconds)
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_RETRIES=3

# ================================
# DEVELOPMENT OVERRIDES
# ================================
# Uncomment these for development/testing

# NODE_ENV=development  
# LOG_LEVEL=debug
# FRONTEND_URL=http://localhost:3000
# CORS_ORIGIN=http://localhost:3000
# USE_DOCKER_SECRETS=false

# Development Database (local)
# DATABASE_URL=postgresql://medianest:dev-password@localhost:5432/medianest_dev

# Development Redis (local)  
# REDIS_URL=redis://localhost:6379

# Development Secrets (insecure - development only)
# JWT_SECRET=dev-jwt-secret-not-for-production
# ENCRYPTION_KEY=dev-encryption-key-32-characters
# NEXTAUTH_SECRET=dev-nextauth-secret

# ================================
# PRODUCTION CHECKLIST
# ================================

# Before deploying to production, ensure:
# [ ] All *_FILE environment variables point to Docker secrets
# [ ] Docker secrets are generated and stored securely  
# [ ] DATABASE_URL contains production PostgreSQL connection string
# [ ] REDIS_URL contains production Redis connection string
# [ ] JWT_SECRET is a cryptographically secure random string
# [ ] ENCRYPTION_KEY is exactly 32 characters (AES-256)
# [ ] PLEX_CLIENT_ID and PLEX_CLIENT_SECRET are from Plex app registration
# [ ] DOMAIN_NAME matches your production domain
# [ ] CERTBOT_EMAIL is valid for Let's Encrypt notifications
# [ ] FRONTEND_URL and CORS_ORIGIN match your production domain
# [ ] LOG_LEVEL is set to 'info' or 'warn' for production
# [ ] METRICS_TOKEN is a secure random string
# [ ] Firewall allows ports 80 and 443
# [ ] DNS A record points to your server IP